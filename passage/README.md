# passage

## Nmap

[Scan Result][1]

## passage.htb news site

On port 80 there is a web server listening, if we try to scan with dirbuster we get an ip ban for two minutes as stated into the news site. 

The news site is a CuteNews server vulnerable to [CVE-2019-11447][2] 

This exploit found some hashes that can be cracked via `hashcat`

`hashcat --stdout rockyou.txt.gz | hashcat passage.txt -m 1400 -O`

```raw
7144a8b531c27a60b51d81ae16be3a81cef722e11b43a26fde0ca97f9e1485e1
4bdd0a0bb47fc9f66cbf1a8982fd2d344d2aec283d1afaebb4653ec3954dff88
e26f3e86d1f8108120723ebe690e5d3d61628f4130076ec6cb43f16f497273cd:atlanta1
f669a6f691f98ab0562356c0cd5d5e7dcdc20a07941c86adcfce9af3085fbeca
4db1f0bfd63be058d4ab04f18f65331ac11bb494b5792c480faf7fb0c40fa9cc
```

Using the console from exploit we can see two homes so there are two users:

`nadav` and `paul` we can try to login via ssh with the password found, but unfortunately they need a private key

We can use the username and password generated by the exploit to login the CuteNews console on `passage.htb/CuteNews/index.php` and going to the user preference we can load a [php reverse shell][3] to get a full terminal.

Using `su` we can get our user flag from user `paul` ***paul:atlanta1***

## Paul

Inside the `.ssh` dir of the user paul we found a couple of keys that seems to belong `nadav` download the private key and try to login via ssh.

## Nadav

Launching [linpeas][4] seems that `USBCreator` is vulnerable to [DBus command injection][5] there are also some path exploitable like `/home/nadav` and `/home/nadav/.local` 

Using the [USBCreator exploit][6] we can steal the root private key and login via ssh

`gdbus call --system --dest com.ubuntu.USBCreator --object-path /com/ubuntu/USBCreator --method com.ubuntu.USBCreator.Image /root/.ssh/id_rsa /tmp/zeru true`

![htbbadge](https://www.hackthebox.eu/badge/image/272787)
![passage](https://www.hackthebox.eu/storage/achievements/dd4d60c703d23c7f86f8938f5438e303.png)

[//]: #links
[1]: nmap/passage.nmap
[2]: https://www.exploit-db.com/exploits/48800
[3]: php-reverse-shell.php
[4]: linpeash.txt
[5]: https://book.hacktricks.xyz/linux-unix/privilege-escalation/d-bus-enumeration-and-command-injection-privilege-escalation
[6]: https://unit42.paloaltonetworks.com/usbcreator-d-bus-privilege-escalation-in-ubuntu-desktop/